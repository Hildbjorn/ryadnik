{% load static %}
{% load common_tags %}

<div class="tab-pane fade show active my-3" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
  <div class="form-control p-3">
    <form action="{{ action }}" id="profile_form" method="POST" enctype="multipart/form-data" class="form">
      {% csrf_token %}
      <div class="profile_container row mb-3">
        <!-- Первый столбец -->
        <div class="col-12 col-md-2 mb-3 mb-md-0">
          <div id="image_preview" class="image d-flex flex-column align-content-between text-center">
            <label for="image_field" class="form-label mb-3">
              {% if user.image %}
                <img class="img-fluid rounded-3" src="{{ user.image.url }}" alt="{{ user }}" />
              {% else %}
                <img class="img-fluid bg-light rounded-3" src="{% static 'img/elements/no_photo.webp' %}" alt="{{ user }}" />
              {% endif %}
              <div class="btn btn-sm btn-secondary w-100 mt-3">
                <i class="bi bi-camera pe-2"></i>Изменить фото
              </div>
            </label>
            <div>{{ form.image }}</div>
          </div>
        </div>
        <!-- Второй столбец -->
        <div class="col-12 col-md-10 col-xl-5 d-flex flex-column">
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1"></div>
            <div class="col-11">
              <h6 class="fw-bold mb-3">Личные данные:</h6>
            </div>
          </div>

          <div class="d-flex flex-column flex-grow-1 justify-content-between">
            <!-- Псевдоним -->
            <div class="row d-flex justify-content-end align-items-center">
              <div class="col-1">
                <i class="bi bi-at text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
              </div>
              <div class="col-11">
                <div class="form-floating mb-1">
                  {{ form.nic_name }}
                  <label for="nic_name">{{ form.nic_name.label }}</label>
                </div>
              </div>
            </div>

            <!-- Фамилия -->
            <div class="row d-flex justify-content-end align-items-center">
              <div class="col-1">
                <i class="bi bi-people text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
              </div>
              <div class="col-11">
                <div class="form-floating mb-1">
                  {{ form.last_name }}
                  <label for="last_name">{{ form.last_name.label }}</label>
                </div>
              </div>
            </div>

            <!-- Имя -->
            <div class="row d-flex justify-content-end align-items-center">
              <div class="col-1">
                <i class="bi bi-person text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
              </div>
              <div class="col-11">
                <div class="form-floating mb-1">
                  {{ form.first_name }}
                  <label for="last_name">{{ form.first_name.label }}</label>
                </div>
              </div>
            </div>

            <!-- Отчество -->
            <div class="row d-flex justify-content-end align-items-center">
              <div class="col-1">
                <i class="bi bi-person-up text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
              </div>
              <div class="col-11">
                <div class="form-floating mb-1">
                  {{ form.middle_name }}
                  <label for="last_name">{{ form.middle_name.label }}</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-md-2 d-xl-none"></div>
        <div class="col-12 col-md-10 col-xl-5">
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1"></div>
            <div class="col-11">
              <h6 class="fw-bold mt-3 mt-xl-0 mb-3">Контакты:</h6>
            </div>
          </div>
          <!-- E-mail -->
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1">
              <i class="bi bi-envelope-at text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
            </div>
            <div class="col-11">
              <div class="form-floating mb-1">
                {{ form.email }}
                {{ form.email.errors }}
                <label for="email">{{ form.email.label }}</label>
              </div>
            </div>
          </div>

          <!-- Телефон -->
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1">
              <i class="bi bi-telephone text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
            </div>
            <div class="col-11">
              <div class="form-floating mb-1">
                {{ form.phone }}
                <label for="phone">{{ form.phone.label }}</label>
              </div>
            </div>
          </div>

          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1"></div>
            <div class="col-11">
              <h6 class="fw-bold my-3">Работа:</h6>
            </div>
          </div>
          <!-- Должность -->
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1">
              <i class="bi bi-diagram-3 text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
            </div>
            <div class="col-11">
              <div class="form-floating mb-1">
                {{ form.position }}
                <label for="position">{{ form.position.label }}</label>
              </div>
            </div>
          </div>

          <!-- Организация -->
          <div class="row d-flex justify-content-end align-items-center">
            <div class="col-1">
              <i class="bi bi-buildings text-primary fs-4 mx-0 mx-lg-2 me-2 me-lg-0"></i>
            </div>
            <div class="col-11">
              <div class="form-floating mb-1">
                {{ form.company }}
                <label for="company">{{ form.company.label }}</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr class="hr" />

      <div class="row mt-3">
        <div class="col-12 col-md-8 col-lg-9 mb-3 mb-md-0">
          <div class="agreement form-check form-switch">
            {{ form.agreement }}
            <label class="form-check-label" for="agreement">
              Согласие с&nbsp;документами:<ul>
                <li>
                  <a href="{% url 'serve_documents' 'User_Agreement.pdf' %}" target="_blank"><i class="bi bi-file-text me-2"></i>пользовательское соглашение</a>
                </li>
                <li>
                  <a href="{% url 'serve_documents' 'Privacy_Policy.pdf' %}" target="_blank"><i class="bi bi-file-text me-2"></i>политика конфиденциальности</a>
                </li>
              </ul>
            </label>
          </div>
          <div class="agreement form-check form-switch mt-3">
            {{ form.subscribe }}
            <label class="form-check-label" for="subscribe">
              Подписка на&nbsp;рассылку <i class="bi bi-envelope-check mx-2"></i> информационных материалов<ul class="mb-0">
                <li>
                  <a href="{% url 'serve_documents' 'Consent_to_Data_processing_and_Advertising.pdf' %}" target="_blank"><i class="bi bi-file-text me-2"></i>соглашение на&nbsp;получение рекламы и&nbsp;обработку персональных данных</a>
                </li>
              </ul>
            </label>
          </div>
        </div>

        <div class="col-12 col-md-4 col-lg-3 mb-3 mb-md-0 align-content-end text-end">
          {% if request.user.is_authenticated and not user.is_superuser %}
            <div class="btn btn-danger me-2" role="button" hx-post="{% url 'profile_delete_confirmation' %}" hx-target="#modal-content" hx-trigger="click" data-bs-toggle="modal" data-bs-target="#modal">
              <i class="bi bi-trash"></i>
            </div>
          {% endif %}
          <button type="submit" class="btn btn-warning btn_submit">
            <i class="bi bi-check-lg me-2"></i>
            Обновить
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
